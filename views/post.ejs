<%- include("partials/header") -%>
<style>
    body {
        font-family: Arial, sans-serif;
        background-color: #f4f4f4;
        margin: 0;
        display: flex;
        flex-direction: column;
        min-height: 100vh;
    }

    .container {
        padding: 20px;
    }

    .search-container {
        display: flex;
        justify-content: center;
        margin-top: 15px;
    }
    
    .search-bar {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 300px;
        margin-right: 10px;
    }

    .radius-bar {
        padding: 10px;
        border: 1px solid #ccc;
        border-radius: 4px;
        width: 100px;
        margin-right: 10px;
    }
    
    .search-button {
        padding: 10px 15px;
        border: none;
        background-color: #27374D;
        color: white;
        border-radius: 4px;
        cursor: pointer;
    }

    .search-button:hover {
        background-color: #1d2a4d;
    }

    .job-posting {
        display: flex;
        flex-direction: column;
        align-items: center;
        margin: 15px auto;
        background-color: white;
        border-radius: 8px;
        padding: 20px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        max-width: 600px;
        width: 100%;
    }
    
    .profile-photo img {
        width: 150px;
        height: 150px;
        border-radius: 8px;
        margin-bottom: 10px;
    }
    
    .job-details {
        text-align: center;
        max-width: 500px;
    }

    .job-details a {
        color: #1a0dab;
        text-decoration: none;
    }
    
    h2.post {
        margin: 10px 0;
        font-size: 22px;
        color: #27374D;
    }

    p.post {
        margin: 5px 0;
        color: #555;
    }

    footer {
        margin-top: auto;
        padding: 10px;
        background-color: #27374D;
        color: white;
        text-align: center;
    }

</style>

<div class="container">
    <div class="search-container">
        <input type="text" id="skillSearch" class="search-bar" placeholder="Search by skill...">
        <input type="number" id="radiusSearch" class="radius-bar" placeholder="Radius (km)" min="0">
        <button id="searchBtn" class="search-button">Search</button>
    </div>

    <div id="postContainer">
        <% if (posts && posts.length > 0) { %>
            <% posts.forEach(post => { %>
                <div class="job-posting">
                    <div class="profile-photo">
                        <img src="<%= post.profile_photo || '/images/default_profile_photo.jpg' %>" alt="Profile Photo">
                    </div>
                    <a href="javascript:void(0);" data_user_id="<%= post.user_id %>" onclick="viewProfile(this)"
                        class="viewProfileBtn"><%= post.username %></a>
                    <div class="jobDetails">
                        <h2><%= post.title %></h2>
                        <p><strong>Skills:</strong> <%= post.skills %></p>
                        <p><strong>Description:</strong> <%= post.content %></p>
                        <p><strong>Posted:</strong> <%= new Date(post.created_at).toLocaleDateString() %></p>
                        <button class="likeBtn" data-post-id="<%= post.post_id %>">
                            <%= post.liked ? 'Unlike' : 'Like' %>
                        </button>
                        <span class="likeCount">Likes: <%= post.like_count || 0 %></span>
                    </div>
                </div>
            <% }) %>
        <% } else { %>
            <p>No posts found.</p>
        <% } %>
     </div>
    
</div>
        
<!-- Footer Section -->
<%- include("partials/footer") -%>
<script src="/view_profile.js"></script>
<script>
    document.getElementById('searchBtn').addEventListener('click', function() {
        const searchTerm = document.getElementById('skillSearch').value.toLowerCase();
        const radius = document.getElementById('radiusSearch').value;

        fetch(`/post/search?skill=${encodeURIComponent(searchTerm)}&radius=${radius}`)
            .then(response => response.text())
            .then(data => {
                document.getElementById('postContainer').innerHTML = data;
            })
            .catch(error => console.error('Error:', error));
    });

    document.getElementById('postContainer').addEventListener('click', function (event) {
        if (event.target.classList.contains('likeBtn')) {
            const button = event.target;
            const postId = button.getAttribute('data-post-id');
            const likeCountSpan = button.nextElementSibling;

            // Disable button while processing
            button.disabled = true;

            // Send a POST request to like/unlike the post
            fetch('/like-post', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({ postId: postId }),
            })
            .then(response => response.json())
            .then(data => {
                button.textContent = data.liked ? 'Unlike' : 'Like';
                likeCountSpan.innerText = `Likes: ${data.like_count}`;
            })
            .catch(error => console.error('Error:', error))
            .finally(() => {
                button.disabled = false; // Re-enable the button
            });
        }
    });
</script>
</body>
</html>
